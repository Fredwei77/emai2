(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();document.addEventListener("DOMContentLoaded",function(){console.log("网站已加载"),typeof NavigationManager<"u"&&new NavigationManager,typeof ContactForm<"u"&&new ContactForm("#contact-form"),typeof enhanceResponsiveImages<"u"&&enhanceResponsiveImages(),P(),R(),z(),K()});function K(){const o=document.getElementById("hero-canvas");if(!o)return;const e=o.getContext("2d",{alpha:!0});let t,i,s;const n=[],d=40;function f(){s=window.devicePixelRatio||1,t=o.clientWidth,i=o.clientHeight,o.width=Math.floor(t*s),o.height=Math.floor(i*s),e.setTransform(s,0,0,s,0,0)}function c(a,m){return Math.random()*(m-a)+a}function w(){n.length=0;for(let a=0;a<d;a++)n.push({x:c(0,t),y:c(0,i),r:c(.6,1.6),vx:c(-.2,.2),vy:c(-.15,.15),alpha:c(.3,.8)})}function I(){const a=e.createLinearGradient(0,0,t,i);a.addColorStop(0,"rgba(255,255,255,0.05)"),a.addColorStop(1,"rgba(255,255,255,0.0)"),e.fillStyle=a,e.fillRect(0,0,t,i)}function E(){e.clearRect(0,0,t,i),I();for(const a of n)a.x+=a.vx,a.y+=a.vy,a.x<-5?a.x=t+5:a.x>t+5&&(a.x=-5),a.y<-5?a.y=i+5:a.y>i+5&&(a.y=-5),e.beginPath(),e.arc(a.x,a.y,a.r,0,Math.PI*2),e.fillStyle=`rgba(255,255,255,${a.alpha})`,e.fill();requestAnimationFrame(E)}const g=()=>{f(),w()};window.addEventListener("resize",g),f(),w(),E()}function P(){try{const o=document.querySelector('meta[name="author"]')?.content||"现代化网站",e=document.title||o,t=document.querySelector('meta[name="description"]')?.content||"",i=typeof window<"u"?window.location.origin+window.location.pathname:"/",s=[];s.push({"@context":"https://schema.org","@type":"WebSite",name:o,url:window.location.origin||"/",potentialAction:{"@type":"SearchAction",target:`${window.location.origin}/?q={search_term_string}`,"query-input":"required name=search_term_string"}}),s.push({"@context":"https://schema.org","@type":"WebPage",name:e,url:i,description:t});const n=window.location.pathname||"/",d=[{name:"首页",path:"/"}];n.includes("about")&&d.push({name:"关于我们",path:"/about.html"}),n.includes("services")&&d.push({name:"服务",path:"/services.html"}),n.includes("contact")&&d.push({name:"联系我们",path:"/contact.html"}),d.length>1&&s.push({"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:d.map((f,c)=>({"@type":"ListItem",position:c+1,name:f.name,item:(window.location.origin||"")+f.path}))}),s.forEach(f=>{const c=document.createElement("script");c.type="application/ld+json",c.text=JSON.stringify(f),document.head.appendChild(c)})}catch(o){console.warn("JSON-LD 注入失败:",o)}}function R(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){const i=this.getAttribute("href").substring(1),s=document.getElementById(i);s&&(t.preventDefault(),s.scrollIntoView({behavior:"smooth",block:"start"}))})})}function z(){window.addEventListener("load",function(){if("performance"in window){const o=performance.getEntriesByType("navigation")[0];if(o){const e=o.loadEventEnd-o.loadEventStart,t=o.domContentLoadedEventEnd-o.domContentLoadedEventStart;console.log(`页面加载时间: ${e}ms`),console.log(`DOM内容加载时间: ${t}ms`)}}})}function W(o,e){let t;return function(...s){const n=()=>{clearTimeout(t),o(...s)};clearTimeout(t),t=setTimeout(n,e)}}function H(o,e){let t;return function(){const i=arguments,s=this;t||(o.apply(s,i),t=!0,setTimeout(()=>t=!1,e))}}function Y(){const o={threshold:.1,rootMargin:"0px 0px -50px 0px"},e=new IntersectionObserver(i=>{i.forEach(s=>{s.isIntersecting&&(s.target.classList.add("animate-fade-in-up"),e.unobserve(s.target))})},o);document.querySelectorAll(".feature-card, .modern-card, .team-card").forEach(i=>{e.observe(i)})}function _(){const o=document.querySelectorAll(".hero-section");if(o.length===0)return;const e=H(()=>{const i=window.pageYOffset*-.5;o.forEach(s=>{s.style.transform=`translateY(${i}px)`})},10);window.addEventListener("scroll",e)}function G(){document.querySelectorAll(".modern-card, .feature-card, .team-card").forEach(e=>{e.addEventListener("mouseenter",function(){this.style.transform="translateY(-8px) scale(1.02)"}),e.addEventListener("mouseleave",function(){this.style.transform="translateY(0) scale(1)"})})}document.addEventListener("DOMContentLoaded",function(){console.log("网站已加载"),typeof NavigationManager<"u"&&new NavigationManager,typeof ContactForm<"u"&&new ContactForm("#contact-form"),typeof enhanceResponsiveImages<"u"&&enhanceResponsiveImages(),P(),R(),z(),Y(),_(),G()});window.debounce=W;window.throttle=H;(function(){try{let g=function(r){c.classList.toggle("open",!!r),w.setAttribute("aria-expanded",r?"true":"false")},x=function(r,l){const u=document.createElement("div");u.className="aiw-msg "+(r==="user"?"aiw-msg-user":"aiw-msg-bot"),u.textContent=l,m.appendChild(u),m.scrollTop=m.scrollHeight},L=function(r){m?.setAttribute("aria-busy",r?"true":"false"),T&&(T.disabled=!!r),M&&(M.disabled=!r),v?.toggleAttribute?.("disabled",!!r)},b=function(){try{clearTimeout(S)}catch{}const r=document.getElementById("aiw-timer");k=180;const l=()=>{if(r){if(k<=0){g(!1);return}r.textContent=`将于 ${Math.ceil(k)}s 后自动关闭`,k-=1,S=setTimeout(l,1e3)}};S=setTimeout(l,1e3)};var o=g,e=x,t=L,i=b;if(!(document.body?.getAttribute("data-wechat-kf-url")||""))return;const d=document.createElement("style");d.textContent=`
    .kf-fab{position:fixed;right:16px;bottom:16px;z-index:50;display:flex;flex-direction:column;gap:10px;align-items:flex-end}
    .kf-btn{background:#0A7EFA;color:#fff;border-radius:9999px;padding:10px 14px;display:flex;align-items:center;gap:8px;box-shadow:0 6px 16px rgba(0,0,0,.15);cursor:pointer;border:0;font-size:14px}
    .kf-btn:hover{background:#066bd3}
    .kf-drawer{position:fixed;right:16px;bottom:72px;width:360px;max-width:94vw;max-height:70vh;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.12);overflow:hidden;display:none}
    .kf-drawer.open{display:block}
    .kf-drawer-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:#f8fafc;border-bottom:1px solid #e5e7eb}
    .kf-drawer-title{font-size:13px;color:#111827}
    .kf-drawer-close{background:transparent;border:0;color:#6b7280;cursor:pointer}

    /* AI chat widget */
    .aiw{display:flex;flex-direction:column;height:480px}
    .aiw-messages{flex:1;overflow:auto;padding:12px;background:#fff}
    .aiw-msg{margin-bottom:8px;padding:10px;border-radius:10px;white-space:pre-wrap;line-height:1.5}
    .aiw-msg-user{background:#e6f0ff;color:#0f172a}
    .aiw-msg-bot{background:#f3f4f6;color:#111827}
    .aiw-input{display:flex;gap:8px;padding:10px;border-top:1px solid #e5e7eb;background:#fafafa}
    .aiw-input input{flex:1;border:1px solid #e5e7eb;border-radius:8px;padding:10px;font-size:14px}
    .aiw-input button{border:0;border-radius:8px;padding:10px 12px;cursor:pointer;font-size:14px}
    .aiw-input #aiw-send{background:#0A7EFA;color:#fff}
    .aiw-input #aiw-send:disabled{opacity:.6;cursor:not-allowed}
    .aiw-input #aiw-stop{background:#e5e7eb;color:#111827}

    .aiw-toolbar{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-top:1px solid #e5e7eb;background:#fafafa}
    .aiw-faq{display:flex;flex-wrap:wrap;gap:6px;padding:8px 10px;border-top:1px solid #e5e7eb;background:#fbfbfb}
    .aiw-faq button{font-size:12px;padding:6px 8px;border:1px solid #e5e7eb;border-radius:999px;background:#fff;cursor:pointer}
    .aiw-faq button:hover{background:#f3f4f6}
    .aiw-qr{width:96px;height:auto;border:1px solid #e5e7eb;border-radius:8px;background:#fff;padding:4px;cursor:zoom-in}
    .aiw-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:60}
    .aiw-overlay img{max-width:92vw;max-height:92vh;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,.4)}
    `,document.head.appendChild(d);const f=document.createElement("div");f.className="kf-fab",f.innerHTML=`
      <div class="kf-drawer" id="kf-drawer" role="dialog" aria-label="AI 客服">
        <div class="kf-drawer-header">
          <div class="kf-drawer-title">AI 客服</div>
          <div class="flex items-center gap-2">
            <button class="kf-drawer-close" id="kf-exit" aria-label="退出">退出</button>
            <button class="kf-drawer-close" id="kf-close" aria-label="关闭">✕</button>
          </div>
        </div>
        <div class="aiw" id="aiw">
          <div class="aiw-messages" id="aiw-messages" aria-live="polite" aria-busy="false"></div>
          <div class="aiw-faq" id="aiw-faq">
            <button data-q="你们提供哪些服务？">你们提供哪些服务？</button>
            <button data-q="如何获取报价？">如何获取报价？</button>
            <button data-q="项目周期一般多久？">项目周期一般多久？</button>
            <button data-q="是否支持后期维护？">是否支持后期维护？</button>
          </div>
          <div class="aiw-toolbar">
            <button id="aiw-human" type="button" title="转人工">转人工</button>
            <small id="aiw-timer" class="text-gray-500"></small>
          </div>
          <div class="aiw-input">
            <input id="aiw-input" type="text" placeholder="请输入您的问题..." aria-label="AI 客服输入框" />
            <button id="aiw-stop" type="button">停止</button>
            <button id="aiw-send" type="button">发送</button>
          </div>
        </div>
      </div>
      <button class="kf-btn" id="kf-open" aria-haspopup="dialog" aria-controls="kf-drawer" aria-expanded="false">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4 4h16v12H5.17L4 17.17V4zm0-2c-1.1 0-2 .9-2 2v20l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2H4z"></path></svg>
        <span>AI 客服</span>
      </button>
    `,document.body.appendChild(f);const c=document.getElementById("kf-drawer"),w=document.getElementById("kf-open"),I=document.getElementById("kf-close"),E=document.getElementById("kf-exit");w.addEventListener("click",()=>{g(!0);try{document.getElementById("aiw-input")?.focus()}catch{}}),I.addEventListener("click",()=>g(!1)),E?.addEventListener("click",()=>{try{clearTimeout(S)}catch{}c.classList.remove("open"),m.innerHTML=""}),document.addEventListener("keydown",r=>{r.key==="Escape"&&g(!1)});const a=document.getElementById("aiw"),m=document.getElementById("aiw-messages"),v=document.getElementById("aiw-input"),T=document.getElementById("aiw-send"),M=document.getElementById("aiw-stop");let J=null;const y=[];let S=null,k=0;async function O(r){if(r){x("user",r),y.push({role:"user",content:r}),v.value="";try{L(!0),b();const l=await fetch("/api/ai-chat/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:y})});if(!l.ok||!l.body)throw new Error(`HTTP ${l.status}`);const u=l.body.getReader(),q=new TextDecoder;let p="";x("assistant","");const h=m.lastElementChild;for(;;){const{value:j,done:C}=await u.read();if(C)break;const A=q.decode(j,{stream:!0}).split(`

`);for(const U of A){const F=U.trim();if(!F||!F.startsWith("data:"))continue;const D=F.slice(5).trim();if(D!=="[DONE]")try{const $=JSON.parse(D),N=$?.choices?.[0]?.delta?.content??$?.choices?.[0]?.message?.content??"";N&&(p+=N,h&&(h.textContent=p),b())}catch{}}}if(p)y.push({role:"assistant",content:p});else{const C=await(await fetch("/api/ai-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:y})})).text();let B=null;try{B=JSON.parse(C)}catch{}const A=B?.output||"(无输出)";h&&(h.textContent=A),B?.ok&&y.push({role:"assistant",content:A})}b()}catch{x("assistant","网络异常，请稍后重试")}finally{L(!1)}}}T?.addEventListener("click",()=>{b(),O((v?.value||"").trim())}),v?.addEventListener("keydown",r=>{r.key==="Enter"&&(r.preventDefault(),b(),O((v?.value||"").trim()))}),M?.addEventListener("click",()=>{try{J?.abort()}catch{}L(!1),b()});try{document.getElementById("aiw-faq")?.addEventListener("click",r=>{const l=r.target.closest("button[data-q]");if(!l)return;const u=l.getAttribute("data-q")||"";u&&(v.value=u,b(),O(u))})}catch{}document.getElementById("aiw-human")?.addEventListener("click",async()=>{const r="AI_YiMai",l=[`weixin://dl/chat?${r}`,`weixin://dl/add?${r}`];for(const h of l)try{window.location.href=h;break}catch{}try{await navigator.clipboard.writeText(r)}catch{}const u="/Wechat%20official%20account.jpg",q=`已尝试打开微信。如未自动跳转，请在微信中搜索添加：<b>${r}</b>（微信号已复制）。

点击下方二维码可放大：`;x("assistant",q.replace(/<[^>]+>/g,"").replace(/\\n/g,`
`));const p=document.createElement("img");p.src=u,p.alt="微信二维码",p.className="aiw-qr",p.addEventListener("click",()=>{const h=document.createElement("div");h.className="aiw-overlay",h.innerHTML=`<img src="${u}" alt="微信二维码放大"/>`,h.addEventListener("click",()=>h.remove()),document.body.appendChild(h)}),m.appendChild(p),m.scrollTop=m.scrollHeight})}catch{}})();class V{constructor(){this.menuButton=document.getElementById("mobile-menu-button"),this.mobileMenu=document.getElementById("mobile-menu"),this.hamburgerIcon=document.getElementById("hamburger-icon"),this.mobileNavLinks=document.querySelectorAll(".mobile-nav-link"),this.isOpen=!1,this.focusableElements=[],this.init()}init(){this.menuButton&&this.mobileMenu&&(this.menuButton.addEventListener("click",()=>this.toggleMenu()),this.menuButton.addEventListener("touchstart",e=>this.handleTouch(e)),document.addEventListener("click",e=>this.handleOutsideClick(e)),document.addEventListener("keydown",e=>this.handleKeydown(e)),window.addEventListener("resize",()=>this.handleResize()),this.mobileNavLinks.forEach(e=>{e.addEventListener("click",()=>this.closeMenu())}),this.updateFocusableElements())}updateFocusableElements(){this.mobileMenu&&(this.focusableElements=this.mobileMenu.querySelectorAll('a[href], button, [tabindex]:not([tabindex="-1"])'))}handleTouch(e){e.preventDefault()}toggleMenu(){this.isOpen=!this.isOpen,this.updateMenuState()}openMenu(){this.isOpen=!0,this.updateMenuState()}closeMenu(){this.isOpen=!1,this.updateMenuState()}updateMenuState(){!this.mobileMenu||!this.menuButton||(this.isOpen?(this.mobileMenu.classList.remove("hidden"),this.mobileMenu.classList.add("show"),this.menuButton.setAttribute("aria-expanded","true"),this.menuButton.setAttribute("aria-label","关闭导航菜单"),this.hamburgerIcon&&this.hamburgerIcon.classList.add("open"),setTimeout(()=>{this.updateFocusableElements(),this.focusableElements.length>0&&this.focusableElements[0].focus()},100),document.body.style.overflow="hidden"):(this.mobileMenu.classList.add("hidden"),this.mobileMenu.classList.remove("show"),this.menuButton.setAttribute("aria-expanded","false"),this.menuButton.setAttribute("aria-label","打开导航菜单"),this.hamburgerIcon&&this.hamburgerIcon.classList.remove("open"),document.body.style.overflow=""))}handleOutsideClick(e){this.isOpen&&this.mobileMenu&&this.menuButton&&!this.mobileMenu.contains(e.target)&&!this.menuButton.contains(e.target)&&this.closeMenu()}handleKeydown(e){e.key==="Escape"&&this.isOpen&&(this.closeMenu(),this.menuButton&&this.menuButton.focus()),e.key==="Tab"&&this.isOpen&&this.handleTabNavigation(e),this.isOpen&&(e.key==="ArrowDown"||e.key==="ArrowUp")&&(e.preventDefault(),this.handleArrowNavigation(e.key))}handleTabNavigation(e){if(this.focusableElements.length===0)return;const t=this.focusableElements[0],i=this.focusableElements[this.focusableElements.length-1];e.shiftKey?document.activeElement===t&&(e.preventDefault(),i.focus()):document.activeElement===i&&(e.preventDefault(),t.focus())}handleArrowNavigation(e){const t=Array.from(this.focusableElements).indexOf(document.activeElement);let i=t;e==="ArrowDown"?(i=t+1,i>=this.focusableElements.length&&(i=0)):e==="ArrowUp"&&(i=t-1,i<0&&(i=this.focusableElements.length-1)),this.focusableElements[i]&&this.focusableElements[i].focus()}handleResize(){window.innerWidth>=768&&this.isOpen&&this.closeMenu()}}let X=class{constructor(){this.mobileNav=null,this.init()}init(){this.mobileNav=new V,this.setActiveMenuItem()}setActiveMenuItem(){const e=window.location.pathname;document.querySelectorAll(".nav-link, .mobile-nav-link").forEach(i=>{const s=i.getAttribute("href");e==="/"||e==="/index.html"?s==="/"||s==="./index.html"?(i.classList.add("active"),i.setAttribute("aria-current","page")):(i.classList.remove("active"),i.removeAttribute("aria-current")):s&&e.includes(s.replace("./",""))?(i.classList.add("active"),i.setAttribute("aria-current","page")):(i.classList.remove("active"),i.removeAttribute("aria-current"))})}},Q=class{constructor(e="#contact-form"){this.form=document.querySelector(e),this.form&&(this.fields={name:this.form.querySelector("#name"),email:this.form.querySelector("#email"),phone:this.form.querySelector("#phone"),subject:this.form.querySelector("#subject"),message:this.form.querySelector("#message")},this.errors={name:this.form.querySelector("#name-error"),email:this.form.querySelector("#email-error"),phone:this.form.querySelector("#phone-error"),subject:this.form.querySelector("#subject-error"),message:this.form.querySelector("#message-error")},this.submitBtn=this.form.querySelector('button[type="submit"]'),this.submitText=this.form.querySelector(".submit-text"),this.loadingText=this.form.querySelector(".loading-text"),this.successBox=document.getElementById("form-success"),this.errorBox=document.getElementById("form-error"),this.endpoint=this.form.getAttribute("data-endpoint")||this.form.getAttribute("action")||"",this.method=(this.form.getAttribute("method")||"POST").toUpperCase(),this.isSubmitting=!1,this.validationTimeout=null,this.autoSaveTimeout=null,this.init())}init(){this.attachEvents(),this.loadDraftData(),this.setupAutoSave(),this.enhanceAccessibility(),this.addProgressIndicator()}attachEvents(){Object.keys(this.fields).forEach(e=>{const t=this.fields[e];t&&(t.addEventListener("input",()=>{clearTimeout(this.validationTimeout),this.validationTimeout=setTimeout(()=>{this.validateField(e),this.updateSubmitButtonState()},300)}),t.addEventListener("blur",()=>{this.validateField(e),this.updateSubmitButtonState()}),t.addEventListener("focus",()=>{this.clearFieldError(e)}))}),this.form.addEventListener("submit",e=>this.handleSubmit(e)),this.form.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="Enter"&&(e.preventDefault(),this.handleSubmit(e))})}async handleSubmit(e){if(e.preventDefault(),this.isSubmitting)return;if(this.clearAlerts(),!this.validateForm()){this.focusFirstError();return}try{this.setSubmitting(!0);const i=this.getPayload();i.timestamp=new Date().toISOString(),i.userAgent=navigator.userAgent,i.referrer=document.referrer,await this.submitForm(i),this.showSuccess(),this.clearDraftData(),this.resetForm()}catch(i){console.error("表单提交失败:",i),this.showError(this.getErrorMessage(i))}finally{this.setSubmitting(!1)}}async submitForm(e){if(this.endpoint){const t=await fetch(this.endpoint,{method:this.method,headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return await t.json()}else return this.handleOfflineSubmission(e)}handleOfflineSubmission(e){const t=JSON.parse(localStorage.getItem("contactSubmissions")||"[]");return t.push(e),localStorage.setItem("contactSubmissions",JSON.stringify(t)),this.tryEmailSubmission(e),Promise.resolve({success:!0,offline:!0})}tryEmailSubmission(e){try{const t=encodeURIComponent(`网站联系表单: ${e.subject}`),i=encodeURIComponent(`姓名: ${e.name}
邮箱: ${e.email}
电话: ${e.phone||"未提供"}
主题: ${e.subject}

消息内容:
${e.message}

提交时间: ${new Date(e.timestamp).toLocaleString()}`),s=`mailto:107251567@qq.com?subject=${t}&body=${i}`;setTimeout(()=>{window.location.href=s},2e3)}catch(t){console.warn("邮件客户端调用失败:",t)}}validateForm(){const e=["name","email","subject","message"];let t=!0;return e.forEach(i=>{this.validateField(i)||(t=!1)}),this.validateField("phone"),t}validateField(e){const t=this.fields[e],i=this.errors[e];if(!t||!i)return!0;const s=t.value.trim();let n="";switch(e){case"name":s?s.length<2?n="姓名至少需要2个字符":s.length>50&&(n="姓名不能超过50个字符"):n="请输入您的姓名";break;case"email":s?this.isValidEmail(s)||(n="请输入有效的邮箱地址"):n="请输入邮箱地址";break;case"phone":s&&!this.isValidPhone(s)&&(n="请输入有效的电话号码");break;case"subject":s||(n="请选择联系主题");break;case"message":s?s.length<10?n="消息内容至少需要10个字符":s.length>2e3&&(n="消息内容不能超过2000个字符"):n="请输入消息内容";break}return n?(this.showFieldError(e,n),!1):(this.clearFieldError(e),!0)}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidPhone(e){return/^[\+]?[0-9\s\-\(\)]{7,20}$/.test(e)}showFieldError(e,t){const i=this.fields[e],s=this.errors[e];i&&s&&(s.textContent=t,s.classList.remove("hidden"),i.setAttribute("aria-invalid","true"),i.classList.add("border-red-500"))}clearFieldError(e){const t=this.fields[e],i=this.errors[e];t&&i&&(i.textContent="",i.classList.add("hidden"),t.removeAttribute("aria-invalid"),t.classList.remove("border-red-500"))}focusFirstError(){const e=Object.keys(this.fields).find(t=>{const i=this.errors[t];return i&&!i.classList.contains("hidden")});e&&this.fields[e]&&this.fields[e].focus()}setSubmitting(e){this.isSubmitting=e,this.submitBtn&&(this.submitBtn.disabled=e),this.submitText&&this.loadingText&&(this.submitText.classList.toggle("hidden",e),this.loadingText.classList.toggle("hidden",!e)),Object.values(this.fields).forEach(t=>{t&&(t.disabled=e)})}updateSubmitButtonState(){if(!this.submitBtn)return;const e=Object.keys(this.errors).some(i=>{const s=this.errors[i];return s&&!s.classList.contains("hidden")}),t=["name","email","subject","message"].every(i=>{const s=this.fields[i];return s&&s.value.trim()});this.submitBtn.disabled=e||!t||this.isSubmitting}getPayload(){return{name:this.fields.name?.value?.trim()||"",email:this.fields.email?.value?.trim()||"",phone:this.fields.phone?.value?.trim()||"",subject:this.fields.subject?.value||"",message:this.fields.message?.value?.trim()||""}}setupAutoSave(){Object.values(this.fields).forEach(e=>{e&&e.addEventListener("input",()=>{clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>{this.saveDraftData()},2e3)})})}saveDraftData(){const e=this.getPayload();Object.values(e).some(t=>t)&&localStorage.setItem("contactFormDraft",JSON.stringify(e))}loadDraftData(){try{const e=localStorage.getItem("contactFormDraft");if(e){const t=JSON.parse(e);Object.keys(t).forEach(i=>{const s=this.fields[i];s&&t[i]&&(s.value=t[i])})}}catch(e){console.warn("加载草稿数据失败:",e)}}clearDraftData(){localStorage.removeItem("contactFormDraft")}resetForm(){this.form.reset(),Object.keys(this.fields).forEach(e=>{this.clearFieldError(e)}),this.updateSubmitButtonState()}enhanceAccessibility(){this.form.setAttribute("novalidate","true"),Object.keys(this.fields).forEach(e=>{const t=this.fields[e],i=this.errors[e];t&&i&&t.setAttribute("aria-describedby",i.id)})}addProgressIndicator(){const e=document.createElement("div");e.className="form-progress mb-4",e.innerHTML=`
            <div class="flex justify-between text-sm text-gray-600 mb-2">
                <span>表单完成度</span>
                <span class="progress-text">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="progress-bar bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        `,this.form.insertBefore(e,this.form.firstChild),this.progressBar=e.querySelector(".progress-bar"),this.progressText=e.querySelector(".progress-text"),Object.values(this.fields).forEach(t=>{t&&t.addEventListener("input",()=>this.updateProgress())})}updateProgress(){const e=["name","email","subject","message"],t=e.filter(s=>{const n=this.fields[s];return n&&n.value.trim()}),i=Math.round(t.length/e.length*100);this.progressBar&&this.progressText&&(this.progressBar.style.width=`${i}%`,this.progressText.textContent=`${i}%`)}clearAlerts(){this.successBox&&this.successBox.classList.add("hidden"),this.errorBox&&this.errorBox.classList.add("hidden")}showSuccess(){this.successBox&&(this.successBox.classList.remove("hidden"),this.successBox.scrollIntoView({behavior:"smooth",block:"nearest"})),this.errorBox&&this.errorBox.classList.add("hidden")}showError(e){if(this.errorBox){this.errorBox.classList.remove("hidden");const t=this.errorBox.querySelector(".flex div:last-child");t&&(t.textContent=e),this.errorBox.scrollIntoView({behavior:"smooth",block:"nearest"})}this.successBox&&this.successBox.classList.add("hidden")}getErrorMessage(e){return e.message.includes("Failed to fetch")?"网络连接失败，请检查网络后重试":e.message.includes("400")?"提交的信息有误，请检查后重试":e.message.includes("500")?"服务器暂时无法处理请求，请稍后重试":"发送失败，请稍后重试或使用其他联系方式"}};function Z(o={}){document.querySelectorAll("img").forEach(t=>{t.getAttribute("loading")||t.setAttribute("loading","lazy"),t.getAttribute("decoding")||t.setAttribute("decoding","async"),t.alt||(t.alt="图片");const i=()=>{t.style.background="#f3f4f6",t.style.objectFit="contain"};t.removeEventListener("error",i),t.addEventListener("error",i,{once:!0})})}window.NavigationManager=X;window.MobileNavigation=V;window.ContactForm=Q;window.enhanceResponsiveImages=Z;
