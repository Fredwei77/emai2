import"./components-Dw_Wk6EH.js";document.addEventListener("DOMContentLoaded",function(){E()});function E(){document.getElementById("contact-form")&&(y(),v(),x(),B(),C(),h())}function h(){const e=document.getElementById("contact-form");if(!e||e.hasAttribute("data-skip-enhanced-submit")&&["1","true","yes"].includes(String(e.getAttribute("data-skip-enhanced-submit")).toLowerCase()))return;const t=document.getElementById("form-success"),a=document.getElementById("form-error"),n=e.querySelector('button[type="submit"]'),o=n?.querySelector(".submit-text"),i=n?.querySelector(".loading-text");function c(r){n&&(n.disabled=r,o&&i&&(o.classList.toggle("hidden",r),i.classList.toggle("hidden",!r)))}e.addEventListener("submit",async r=>{r.preventDefault(),t?.classList.add("hidden"),a?.classList.add("hidden");const g=new FormData(e),l=Object.fromEntries(g.entries()),p=["name","email","subject","message"];for(const m of p){const u=(l[m]||"").toString().trim(),d=document.getElementById(`${m}-error`);if(u)d?.classList.add("hidden"),d&&(d.textContent="");else{d?.classList.remove("hidden"),d&&(d.textContent="此项为必填");return}}try{c(!0);const m=await fetch("/api/send-contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l.name,email:l.email,phone:l.phone,subject:l.subject,message:l.message})}),u=await m.json().catch(()=>({ok:!1}));if(m.ok&&u.ok)t?.classList.remove("hidden"),a?.classList.add("hidden"),e.reset(),e.querySelectorAll("input, textarea, select").forEach(d=>{d.dispatchEvent(new Event("input")),d.dispatchEvent(new Event("change"))});else throw new Error(u?.error||`HTTP ${m.status}`)}catch(m){console.warn("发送失败:",m),a&&(a.textContent="发送失败，请稍后重试或使用其他联系方式。",a.classList.remove("hidden"))}finally{c(!1)}})}function y(){const e=document.getElementById("message"),s=document.getElementById("message-counter");if(!e||!s)return;const t=2e3;function a(){const n=e.value.length;s.textContent=`${n}/${t}`,n>t*.95?(s.className="text-xs text-red-500 font-medium",s.textContent=`${n}/${t} - 即将达到字符限制`):n>t*.8?s.className="text-xs text-yellow-600 font-medium":s.className="text-xs text-gray-500",n>t&&(s.className="text-xs text-red-600 font-bold",s.textContent=`${n}/${t} - 超出建议长度`)}e.addEventListener("input",a),e.addEventListener("paste",()=>setTimeout(a,0)),e.addEventListener("keydown",function(n){!(["Backspace","Delete","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","Tab"].includes(n.key)||n.ctrlKey||n.metaKey)&&e.value.length>=3e3&&(n.preventDefault(),s.textContent=`${e.value.length}/2000 - 已达到最大字符限制`,s.className="text-xs text-red-600 font-bold")}),a()}function v(){const e={name:document.getElementById("name"),email:document.getElementById("email"),phone:document.getElementById("phone"),subject:document.getElementById("subject"),message:document.getElementById("message")};Object.keys(e).forEach(s=>{const t=e[s];t&&b(t,s)})}function b(e,s){const a={name:"请输入您的真实姓名，便于我们称呼您",email:"请输入常用邮箱，我们将通过邮箱回复您",phone:"可选填写，便于紧急情况下联系您",subject:"选择最符合您需求的主题",message:"详细描述您的需求，有助于我们更好地为您服务"}[s];if(!a)return;const n=document.createElement("div");n.className="text-xs text-blue-600 mt-1 opacity-0 transition-opacity duration-200",n.textContent=a,n.id=`${s}-hint`;const o=document.getElementById(`${s}-error`);o&&o.parentNode.insertBefore(n,o),e.addEventListener("focus",()=>{n.classList.remove("opacity-0"),n.classList.add("opacity-100")}),e.addEventListener("blur",()=>{e.value.trim()&&(n.classList.add("opacity-0"),n.classList.remove("opacity-100"))})}function x(){const e=document.getElementById("contact-form");e&&(document.addEventListener("keydown",s=>{if((s.ctrlKey||s.metaKey)&&s.key==="Enter"){s.preventDefault();const t=e.querySelector('button[type="submit"]');t&&!t.disabled&&t.click()}s.key==="Escape"&&(document.activeElement.tagName==="INPUT"||document.activeElement.tagName==="TEXTAREA")&&document.activeElement.value&&(document.activeElement.value="",document.activeElement.dispatchEvent(new Event("input")))}),L())}function L(){const e=document.getElementById("contact-form");if(!e)return;const s=document.createElement("div");s.className="text-xs text-gray-400 mt-2 flex flex-wrap gap-4",s.innerHTML=`
        <span class="flex items-center">
            <kbd class="px-1 py-0.5 bg-gray-100 rounded text-xs">Ctrl</kbd>
            <span class="mx-1">+</span>
            <kbd class="px-1 py-0.5 bg-gray-100 rounded text-xs">Enter</kbd>
            <span class="ml-1">快速提交</span>
        </span>
        <span class="flex items-center">
            <kbd class="px-1 py-0.5 bg-gray-100 rounded text-xs">Esc</kbd>
            <span class="ml-1">清除当前字段</span>
        </span>
    `;const t=e.querySelector('button[type="submit"]');t&&t.parentNode.insertBefore(s,t.nextSibling)}(function(){document.addEventListener("click",async s=>{if(!s.target.closest("#copy-email-btn"))return;const a=document.getElementById("contact-email"),n=document.getElementById("copy-email-success");if(!a)return;const o=a.textContent.trim();try{await navigator.clipboard.writeText(o),n&&(n.classList.remove("hidden"),setTimeout(()=>n.classList.add("hidden"),1500))}catch{const c=document.createElement("textarea");c.value=o,document.body.appendChild(c),c.select();try{document.execCommand("copy")}catch{}document.body.removeChild(c),n&&(n.classList.remove("hidden"),setTimeout(()=>n.classList.add("hidden"),1500))}})})();function B(){S(),w(),I()}function S(){const e=document.getElementById("email");if(!e)return;const s=["qq.com","163.com","126.com","gmail.com","hotmail.com","sina.com"],t=document.createElement("div");t.className="absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg hidden",t.id="email-suggestions",e.parentNode.style.position="relative",e.parentNode.appendChild(t),e.addEventListener("input",a=>{const n=a.target.value,o=n.indexOf("@");if(o>0&&o===n.length-1)f(n,s,t);else if(o>0){const i=n.substring(o+1),c=s.filter(r=>r.startsWith(i));c.length>0&&i!==c[0]?f(n.substring(0,o+1),c,t):t.classList.add("hidden")}else t.classList.add("hidden")}),document.addEventListener("click",a=>{!e.contains(a.target)&&!t.contains(a.target)&&t.classList.add("hidden")})}function f(e,s,t){t.innerHTML="",s.slice(0,5).forEach(a=>{const n=document.createElement("div");n.className="px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",n.textContent=e+a,n.addEventListener("click",()=>{document.getElementById("email").value=e+a,t.classList.add("hidden"),document.getElementById("email").dispatchEvent(new Event("input"))}),t.appendChild(n)}),t.classList.remove("hidden")}function w(){const e=document.getElementById("phone");e&&e.addEventListener("input",s=>{let t=s.target.value.replace(/\D/g,"");t.length>0&&(t.startsWith("86")?t="+86 "+t.substring(2):t.length===11&&t.startsWith("1")&&(t=t.replace(/(\d{3})(\d{4})(\d{4})/,"$1 $2 $3"))),s.target.value=t})}function I(){const e=document.getElementById("name");e&&e.addEventListener("input",s=>{const t=s.target.value,o=t.split(" ").map(i=>i.length>0?i.charAt(0).toUpperCase()+i.slice(1).toLowerCase():i).join(" ");o!==t&&(s.target.value=o)})}function C(){const e=document.getElementById("contact-form");if(!e)return;const s="contactFormState";a(),e.addEventListener("input",k(t,1e3)),e.addEventListener("change",t),e.addEventListener("submit",()=>{setTimeout(()=>{document.getElementById("form-success")&&!document.getElementById("form-success").classList.contains("hidden")&&n()},100)});function t(){const o=new FormData(e),i={};for(let[c,r]of o.entries())i[c]=r;localStorage.setItem(s,JSON.stringify(i))}function a(){try{const o=localStorage.getItem(s);if(o){const i=JSON.parse(o);Object.keys(i).forEach(c=>{const r=e.querySelector(`[name="${c}"]`);r&&i[c]&&(r.value=i[c],r.dispatchEvent(new Event("input")))})}}catch(o){console.warn("加载表单状态失败:",o)}}function n(){localStorage.removeItem(s)}}function k(e,s){let t;return function(...n){const o=()=>{clearTimeout(t),e(...n)};clearTimeout(t),t=setTimeout(o,s)}}
